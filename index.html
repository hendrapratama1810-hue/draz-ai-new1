<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>DRAZ AI 1.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;}
body{background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);height:100vh;display:flex;justify-content:center;align-items:flex-start;overflow:hidden;}
.glass{background:rgba(255,255,255,.12);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,.3);}
.sidebar{position:fixed;left:-260px;top:0;width:220px;height:100%;padding:20px;transition:.4s;z-index:5;overflow-y:auto;}
.sidebar.active{left:0;}
.menu-title{color:white;font-size:18px;margin-bottom:15px;font-weight:600;}
.menu button{width:100%;margin-bottom:10px;padding:12px;border:none;border-radius:14px;background:rgba(255,255,255,.15);color:white;text-align:left;font-size:15px;cursor:pointer;transition:.2s;}
.menu button:hover{background:rgba(255,255,255,.25);}
.history div{padding:10px;margin-bottom:8px;border-radius:12px;background:rgba(255,255,255,.1);color:white;font-size:14px;cursor:pointer;}
.hamburger{position:fixed;top:15px;left:15px;font-size:28px;color:white;cursor:pointer;z-index:10;}
.title-bar{position:fixed;top:18px;left:60px;color:white;font-size:20px;font-weight:600;z-index:10;}
.chat-container{margin-top:60px;width:90%;max-width:500px;flex:1;display:flex;flex-direction:column;position:relative;}
.messages{flex:1;overflow-y:auto;padding:15px;margin-bottom:5px;}
.msg{margin-bottom:12px;max-width:80%;padding:12px 15px;border-radius:18px;color:white;font-size:15px;animation:fadeIn 0.3s ease;word-wrap:break-word;}
.user{background:rgba(0,122,255,.35);align-self:flex-end;}
.ai{background:rgba(255,255,255,.18);align-self:flex-start;position:relative;}
.loading-dot{width:8px;height:8px;background:white;border-radius:50%;display:inline-block;margin:0 2px;animation:blink 1s infinite;}
@keyframes blink{0%,80%,100%{opacity:0}40%{opacity:1}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.input-box{display:flex;gap:10px;padding:10px;position:sticky;bottom:0;background:rgba(255,255,255,.05);}
.input-box input{flex:1;padding:12px 15px;border-radius:20px;border:none;outline:none;background:rgba(255,255,255,.2);color:white;}
.input-box button{width:45px;border-radius:50%;border:none;background:rgba(0,122,255,.8);color:white;font-size:18px;cursor:pointer;}
.select-template{margin-bottom:10px;padding:10px;border-radius:14px;background:rgba(255,255,255,.15);color:white;border:none;cursor:pointer;width:100%;transition:.2s;}
.select-template:hover{background:rgba(255,255,255,.25);}
</style>
</head>
<body>

<div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
<div class="title-bar">DRAZ AI 1.0</div>

<div class="sidebar glass" id="sidebar">
  <div class="menu">
    <div class="menu-title">Fitur</div>
    <button onclick="newChat()">‚ûï Obrolan Baru</button>
    <div class="menu-title">Template Prompt</div>
    <select class="select-template" id="templatePrompt" onchange="applyTemplate()">
      <option value="">Pilih template...</option>
      <option value="Bagaimana cara membuat script html">Bagaimana cara membuat script html</option>
      <option value="Berita hari ini">Berita hari ini</option>
      <option value="Mengapa saya tidak pintar">Mengapa saya tidak pintar</option>
      <option value="Buatkan saya rumus matematika yang gampang">Buatkan saya rumus matematika yang gampang</option>
    </select>
    <button onclick="alert('Mode gambar belum aktif')">üé® Membuat Gambar</button>
  </div>
  <div class="history" id="history">
    <div class="menu-title">History</div>
  </div>
</div>

<div class="chat-container glass">
  <div class="messages" id="messages">
    <div class="msg ai">Halo üëã Ada yang bisa saya bantu?</div>
  </div>
  <div class="input-box">
    <input id="input" placeholder="Ketik pesan..." />
    <button id="send">‚û§</button>
  </div>
</div>

<script>
let chats = JSON.parse(localStorage.getItem("chats")) || {};
let currentChatId = null;
const messages = document.getElementById("messages");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const historyBox = document.getElementById("history");
const templateSelect = document.getElementById("templatePrompt");

function toggleMenu(){document.getElementById("sidebar").classList.toggle("active");}

function addMsg(text, role, save = true){
  const div = document.createElement("div");
  div.className = "msg "+role;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  if(save && currentChatId){
    chats[currentChatId].messages.push({role,content:text});
    localStorage.setItem("chats",JSON.stringify(chats));
  }
}

function newChat(){
  currentChatId="chat_"+Date.now();
  chats[currentChatId]={title:"Chat Baru",messages:[]};
  messages.innerHTML="";
  addMsg("Obrolan baru dimulai üëã","ai");
  updateHistory();
}

function loadChat(id){
  currentChatId=id;
  messages.innerHTML="";
  chats[id].messages.forEach(m=>addMsg(m.content,m.role,false));
}

function updateHistory(){
  historyBox.innerHTML='<div class="menu-title">History</div>';
  Object.keys(chats).reverse().forEach(id=>{
    const d=document.createElement("div");
    d.textContent=chats[id].title;
    d.onclick=()=>loadChat(id);
    historyBox.appendChild(d);
  });
}

function applyTemplate(){
  const val = templateSelect.value;
  if(val){input.value=val; templateSelect.value="";}
}

sendBtn.onclick=sendMessage;
input.addEventListener("keydown",e=>{if(e.key==="Enter") sendMessage();});

async function sendMessage(){
  const text=input.value.trim();
  if(!text) return;
  if(!currentChatId) newChat();

  addMsg(text,"user");
  input.value="";

  // Loading animasi kecil
  const typing=document.createElement("div");
  typing.className="msg ai";
  typing.innerHTML=`<span class="loading-dot"></span><span class="loading-dot"></span><span class="loading-dot"></span> AI sedang berpikir...`;
  messages.appendChild(typing);
  messages.scrollTop=messages.scrollHeight;

  try{
    const res = await fetch("/api/hybrid",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({prompt:text, chatId:currentChatId})
    });
    const data = await res.json();
    typing.remove();

    // Filter keamanan
    let reply = data.reply||"";
    const forbidden = /(nurut|ikut|anjing|bodoh|porno|sex|sange|tolong)/gi;
    if(forbidden.test(text)){
      reply = "‚ùå Tolak perintah demi keamanan.";
    }

    addMsg(reply,"ai");

    if(chats[currentChatId].messages.length===2){
      chats[currentChatId].title=text.slice(0,20)+"...";
      updateHistory();
    }

  }catch{
    typing.textContent="‚ùå Gagal koneksi Hybrid API";
  }
}

updateHistory();
</script>

</body>
</html>
